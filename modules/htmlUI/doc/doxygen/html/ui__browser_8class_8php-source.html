<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LiveSupport&amp;nbsp;-&amp;nbsp;htmlUI&amp;nbsp;module: ui_browser.class.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">var</a></div>
<h1>ui_browser.class.php</h1><a href="ui__browser_8class_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 &lt;?php
<a name="l00002"></a><a class="code" href="classuiBrowser.html">00002</a> <span class="keyword">class </span><a class="code" href="classuiBrowser.html">uiBrowser</a> <span class="keyword">extends</span> <a class="code" href="classuiBase.html">uiBase</a> {
<a name="l00003"></a><a class="code" href="classuiBrowser.html#o0">00003</a>     var <a class="code" href="classuiBrowser.html#o0">$alertMsg</a>;
00004 
00005     <span class="comment">// --- class constructor ---</span>
<a name="l00015"></a><a class="code" href="classuiBrowser.html#a0">00015</a> <span class="comment"></span>    function <a class="code" href="classuiBrowser.html#a0">uiBrowser</a>($config)
00016     {
00017         $dbc = DB::connect($config['dsn'], TRUE);
00018         $dbc-&gt;setFetchMode(DB_FETCHMODE_ASSOC);
00019         $this-&gt;gb = &amp;<span class="keyword">new</span> GreenBox(&amp;$dbc, $config);
00020         $this-&gt;<span class="keywordtype">id</span> = (!<a class="code" href="ui__handler_8php.html#a11">$_REQUEST</a>['<span class="keywordtype">id</span>'] ? $this-&gt;gb-&gt;storId : <a class="code" href="ui__handler_8php.html#a11">$_REQUEST</a>['<span class="keywordtype">id</span>']);
00021         $this-&gt;sessid = <a class="code" href="ui__handler_8php.html#a11">$_REQUEST</a>[<a class="code" href="conf_8php.html#a0">$config</a>['authCookieName']];
00022         $this-&gt;userid = $this-&gt;gb-&gt;getSessUserId($this-&gt;sessid);
00023         $this-&gt;login  = $this-&gt;gb-&gt;getSessLogin($this-&gt;sessid);
00024         $this-&gt;InputTextStandardAttrib = array('size'     =&gt;<a class="code" href="conf_8php.html#a4">UI_INPUT_STANDARD_SIZE</a>,
00025                                                'maxlength'=&gt;<a class="code" href="conf_8php.html#a5">UI_INPUT_STANDARD_MAXLENGTH</a>);
00026 
00027     }
00028 
00029     <span class="comment">// --- error handling ---</span>
<a name="l00038"></a><a class="code" href="classuiBrowser.html#a1">00038</a> <span class="comment"></span>    function <a class="code" href="classuiBrowser.html#a1">alertMsg</a>()
00039     {
00040         <span class="keywordflow">if</span> ($_SESSION['<a class="code" href="classuiBrowser.html#a1">alertMsg</a>']) {
00041             $this-&gt;alertMsg = $_SESSION['alertMsg'];
00042             unset($_SESSION['alertMsg']);
00043             <span class="keywordflow">return</span> $this-&gt;alertMsg;
00044         }
00045         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00046     }
00047 
00048     <span class="comment">// --- template feed ---</span>
<a name="l00057"></a><a class="code" href="classuiBrowser.html#a2">00057</a> <span class="comment"></span>    function <a class="code" href="classuiBrowser.html#a2">loginform</a>(&amp;$Smarty, &amp;$mask)
00058     {
00059         $form = <span class="keyword">new</span> HTML_QuickForm('loginbox', UI_STANDARD_FORM_METHOD, <a class="code" href="conf_8php.html#a1">UI_HANDLER</a>);
00060         $form-&gt;setRequiredNote(file_get_contents(<a class="code" href="conf_8php.html#a8">UI_QFORM_REQUIREDNOTE</a>));
00061         $this-&gt;<a class="code" href="classuiBase.html#a1">_parseArr2Form</a>($form, $mask);
00062 
00063 <span class="preprocessor">        ## using Static Smarty Renderer</span>
00064 <span class="preprocessor"></span>        $renderer =&amp; <span class="keyword">new</span> HTML_QuickForm_Renderer_ArraySmarty($Smarty, <span class="keyword">true</span>);
00065         $renderer-&gt;setRequiredTemplate(file_get_contents(<a class="code" href="conf_8php.html#a7">UI_QFORM_REQUIRED</a>));
00066         $renderer-&gt;setErrorTemplate(file_get_contents(<a class="code" href="conf_8php.html#a9">UI_QFORM_ERROR</a>));
00067 
00068         $form-&gt;accept($renderer);
00069 
00070         <span class="keywordflow">return</span> $renderer-&gt;toArray();
00071     }
00072 
00073 
00074 
00075 
<a name="l00083"></a><a class="code" href="classuiBrowser.html#a3">00083</a>     function <a class="code" href="classuiBrowser.html#a3">getUserInfo</a>()
00084     {
00085         <span class="keywordflow">return</span> array('uname'=&gt;$this-&gt;gb-&gt;getSessLogin($this-&gt;sessid),
00086                      'uid'  =&gt;$this-&gt;gb-&gt;getSessUserId($this-&gt;sessid));
00087     }
00088 
<a name="l00099"></a><a class="code" href="classuiBrowser.html#a4">00099</a>     function <a class="code" href="classuiBrowser.html#a4">getStructure</a>($<span class="keywordtype">id</span>, $homedir=FALSE)
00100     {
00101         <span class="keywordflow">if</span> ($homedir) {
00102             $id = $this-&gt;gb-&gt;getObjId($this-&gt;login, $this-&gt;gb-&gt;storId);
00103             $data['<span class="keywordtype">id</span>'] = $id;
00104         } <span class="keywordflow">else</span> {
00105             $data['<span class="keywordtype">id</span>'] = $id;
00106         }
00107 
00108         $data=array_merge($data, array(
00109                 'pathdata'  =&gt; $this-&gt;gb-&gt;getPath($<span class="keywordtype">id</span>, $this-&gt;sessid),
00110                 'listdata'  =&gt; ($this-&gt;gb-&gt;getObjType($<span class="keywordtype">id</span>)=='Folder'?
00111                     $this-&gt;gb-&gt;listFolder($<span class="keywordtype">id</span>, $this-&gt;sessid):array()
00112                 ),
00113                 'tree'  =&gt; (<a class="code" href="ui__handler_8php.html#a11">$_REQUEST</a>['tree']==<span class="charliteral">'Y'</span>),
00114                 'showPath'  =&gt; <span class="keyword">true</span>,
00115                 'showTree'  =&gt; <span class="keyword">true</span>,
00116             ));
00117             <span class="keywordflow">if</span>(<a class="code" href="ui__handler_8php.html#a11">$_REQUEST</a>['tree']==<span class="charliteral">'Y'</span>){
00118                 $data['treedata'] = $this-&gt;gb-&gt;getSubTree($<span class="keywordtype">id</span>, $this-&gt;sessid);
00119             }
00120 
00121         <span class="keywordflow">if</span>(PEAR::isError($data['listdata'])){
00122             $data['msg'] = $data['listdata']-&gt;getMessage();
00123             $data['listdata'] = array();
00124         }
00125 
00126         <span class="keywordflow">return</span> $data;
00127     }
00128 
00129 
<a name="l00139"></a><a class="code" href="classuiBrowser.html#a5">00139</a>     function <a class="code" href="classuiBrowser.html#a5">getNewFileForm</a>($<span class="keywordtype">id</span>, $mask)
00140     {
00141         $form = <span class="keyword">new</span> HTML_QuickForm('<a class="code" href="ui__browser_8php.html#a2">newfile</a>', UI_STANDARD_FORM_METHOD, <a class="code" href="conf_8php.html#a1">UI_HANDLER</a>);
00142         $form-&gt;setConstants(array('<span class="keywordtype">id</span>'=&gt;$<span class="keywordtype">id</span>));
00143         $form-&gt;addElement('hidden', '<span class="keywordtype">id</span>');
00144 
00145         $this-&gt;<a class="code" href="classuiBase.html#a1">_parseArr2Form</a>($form, $mask);
00146 
00147         <span class="keywordflow">return</span> $form-&gt;toHTML();
00148     }
00149 
00150 
<a name="l00160"></a><a class="code" href="classuiBrowser.html#a6">00160</a>     function <a class="code" href="classuiBrowser.html#a6">getSearchForm</a>($<span class="keywordtype">id</span>, &amp;$mask)
00161     {
00162         $form = <span class="keyword">new</span> HTML_QuickForm('<a class="code" href="ui__browser_8php.html#a4">search</a>', UI_STANDARD_FORM_METHOD, <a class="code" href="conf_8php.html#a2">UI_BROWSER</a>);
00163         $form-&gt;setConstants(array('<span class="keywordtype">id</span>'=&gt;$<span class="keywordtype">id</span>));
00164         $form-&gt;addElement('hidden', '<span class="keywordtype">id</span>');
00165 
00166         $this-&gt;<a class="code" href="classuiBase.html#a1">_parseArr2Form</a>($form, $mask);
00167 
00168         <span class="keywordflow">return</span> $form-&gt;toHTML();
00169     }
00170 
<a name="l00178"></a><a class="code" href="classuiBrowser.html#a7">00178</a>     function <a class="code" href="classuiBrowser.html#a7">getSubjects</a>()
00179     {
00180         <span class="keywordflow">return</span> array('subj'       =&gt; $this-&gt;gb-&gt;getSubjectsWCnt(),
00181                      'loggedAs'   =&gt; $this-&gt;login
00182                     );
00183     }
00184 
00185 
<a name="l00193"></a><a class="code" href="classuiBrowser.html#a8">00193</a>     function <a class="code" href="classuiBrowser.html#a8">getAddSubjectForm</a>($mask)
00194     {
00195         $form = <span class="keyword">new</span> HTML_QuickForm('addSubject', UI_STANDARD_FORM_METHOD, <a class="code" href="conf_8php.html#a1">UI_HANDLER</a>);
00196 <span class="preprocessor">        #$form-&gt;setConstants(array('act'=&gt;'addSubj'));</span>
00197 <span class="preprocessor"></span><span class="preprocessor">        #$form-&gt;addElement('hidden', 'act');</span>
00198 <span class="preprocessor"></span><span class="preprocessor">        #$form-&gt;addElement('text', 'login', $this-&gt;tra('Add Subject with Name'), $this-&gt;InputTextStandardAttrib);</span>
00199 <span class="preprocessor"></span><span class="preprocessor">        #$form-&gt;addElement('password', 'pass', $this-&gt;tra('and Password'), $this-&gt;InputTextStandardAttrib);</span>
00200 <span class="preprocessor"></span><span class="preprocessor">        #$form-&gt;addElement('submit', NULL, $this-&gt;tra('Add'));</span>
00201 <span class="preprocessor"></span><span class="preprocessor">        #$form-&gt;addRule('login', $this-&gt;tra('enter a Subject Name'), 'required', null, 'client');</span>
00202 <span class="preprocessor"></span><span class="preprocessor">        #$form-&gt;addRule('pass', $this-&gt;tra('enter a Password'), 'required', null, 'client');</span>
00203 <span class="preprocessor"></span>        $this-&gt;<a class="code" href="classuiBase.html#a1">_parseArr2Form</a>($form, $mask);
00204         <span class="keywordflow">return</span> $form-&gt;toHTML();
00205     }
00206 
<a name="l00214"></a><a class="code" href="classuiBrowser.html#a9">00214</a>     function <a class="code" href="classuiBrowser.html#a9">getChangePasswdForm</a>($uid)
00215     {
00216         $form = <span class="keyword">new</span> HTML_QuickForm('<a class="code" href="ui__handler_8php.html#a15">changePasswd</a>', UI_STANDARD_FORM_METHOD, <a class="code" href="conf_8php.html#a1">UI_HANDLER</a>);
00217         $form-&gt;setConstants(array('act'=&gt;'<a class="code" href="ui__handler_8php.html#a15">changePasswd</a>',
00218                                   'uid'=&gt;$uid));
00219         $form-&gt;addElement('hidden', 'act');
00220         $form-&gt;addElement('hidden', 'uid');
00221         $form-&gt;addElement('text', 'oldpass', $this-&gt;tra('Old Password'), $this-&gt;InputTextStandardAttrib);
00222         $form-&gt;addElement('text', 'pass', $this-&gt;tra('<span class="keyword">new</span> Password'), $this-&gt;InputTextStandardAttrib);
00223         $form-&gt;addElement('text', 'pass2', $this-&gt;tra('retype <span class="keyword">new</span> Password'), $this-&gt;InputTextStandardAttrib);
00224         $form-&gt;addElement('submit', NULL, $this-&gt;tra('Change'));
00225         $form-&gt;addRule('oldpass', $this-&gt;tra('enter Old Password'), 'required', null, 'client');
00226         $form-&gt;addRule('pass', $this-&gt;tra('enter <span class="keyword">new</span> Password'), 'required', null, 'client');
00227         $form-&gt;addRule('pass2', $this-&gt;tra('retype <span class="keyword">new</span> Password'), 'required', null, 'client');
00228         $form-&gt;addRule(array('pass', 'pass2'), 'The passwords <span class="keywordflow">do</span> not match', 'compare', null, 'client');
00229 
00230         <span class="keywordflow">return</span> $form-&gt;toHTML();
00231     }
00232 
<a name="l00241"></a><a class="code" href="classuiBrowser.html#a10">00241</a>     function <a class="code" href="classuiBrowser.html#a10">getGroups</a>($<span class="keywordtype">id</span>)
00242     {
00243         <span class="keywordflow">return</span> array(
00244             'rows'      =&gt; $this-&gt;gb-&gt;listGroup($<span class="keywordtype">id</span>),
00245             '<span class="keywordtype">id</span>'        =&gt; $id,
00246             'loggedAs'  =&gt; $this-&gt;login,
00247             'gname'     =&gt; $this-&gt;gb-&gt;getSubjName($<span class="keywordtype">id</span>),
00248             'subj'      =&gt; $this-&gt;gb-&gt;getSubjects()
00249         );
00250     }
00251 
00252 
<a name="l00262"></a><a class="code" href="classuiBrowser.html#a11">00262</a>     function <a class="code" href="classuiBrowser.html#a11">getSubj2GroupForm</a>($<span class="keywordtype">id</span>)
00263     {
00264         $g = $this-&gt;<a class="code" href="classuiBrowser.html#a10">getGroups</a>($<span class="keywordtype">id</span>);
00265         foreach($g['subj'] as $s) {
00266             $this-&gt;logins[($s['login'])]=$s['login'];
00267         }
00268 
00269         $form = <span class="keyword">new</span> HTML_QuickForm('<a class="code" href="ui__handler_8php.html#a18">addSubj2Group</a>', UI_STANDARD_FORM_METHOD, <a class="code" href="conf_8php.html#a1">UI_HANDLER</a>);
00270         $form-&gt;setConstants(array('act'=&gt;'<a class="code" href="ui__handler_8php.html#a18">addSubj2Group</a>',
00271                                   'reid'=&gt;$g['<span class="keywordtype">id</span>'],
00272                                   'gname'=&gt;$g['gname']));
00273         $form-&gt;addElement('hidden', 'act');
00274         $form-&gt;addElement('hidden', 'reid');
00275         $form-&gt;addElement('hidden', 'gname');
00276         $s =&amp; $form-&gt;createElement('select', 'login', 'Add Group: ');
00277         $s-&gt;loadArray($this-&gt;logins, NULL);
00278         $form-&gt;addElement($s);
00279         $form-&gt;addElement('submit', NULL, $this-&gt;tra('Do'));
00280 
00281         <span class="keywordflow">return</span> $form-&gt;toHTML();
00282     }
00283 
<a name="l00293"></a><a class="code" href="classuiBrowser.html#a12">00293</a>     function <a class="code" href="classuiBrowser.html#a12">getPermissions</a>($<span class="keywordtype">id</span>)
00294     {
00295         <span class="keywordflow">return</span> array('pathdata'  =&gt; $this-&gt;gb-&gt;getPath($<span class="keywordtype">id</span>),
00296                      'perms'     =&gt; $this-&gt;gb-&gt;getObjPerms($<span class="keywordtype">id</span>),
00297                      'actions'   =&gt; $this-&gt;gb-&gt;getAllowedActions($this-&gt;gb-&gt;getObjType($<span class="keywordtype">id</span>)),
00298                      '<a class="code" href="ui__browser_8php.html#a5">subjects</a>'  =&gt; $this-&gt;gb-&gt;getSubjects(),
00299                      '<span class="keywordtype">id</span>'        =&gt; $id,
00300                      'loggedAs'  =&gt; $this-&gt;login
00301                      );
00302     }
00303 
<a name="l00313"></a><a class="code" href="classuiBrowser.html#a13">00313</a>     function <a class="code" href="classuiBrowser.html#a13">getNewFileData</a>($<span class="keywordtype">id</span>)
00314     {
00315         <span class="keywordflow">return</span> array('pathdata'  =&gt; $this-&gt;gb-&gt;getPath($<span class="keywordtype">id</span>, $this-&gt;sessid),
00316                      'showEdit'  =&gt; <span class="keyword">true</span>,
00317                      '<span class="keywordtype">id</span>'    =&gt; $id,
00318                       );
00319     }
00320 
<a name="l00330"></a><a class="code" href="classuiBrowser.html#a14">00330</a>     function <a class="code" href="classuiBrowser.html#a14">getSearchRes</a>($<span class="keywordtype">id</span>, $search)
00331     {
00332         foreach ($this-&gt;gb-&gt;localSearch($<a class="code" href="ui__browser_8php.html#a4">search</a>, $this-&gt;sessid) as $rec) {
00333                 $res = array('items' =&gt; array('gunid'  =&gt; $rec,
00334                                               'par_id' =&gt; $this-&gt;gb-&gt;_idFromGunid($rec)));
00335             }
00336 
00337         <span class="keywordflow">return</span> array('<a class="code" href="ui__browser_8php.html#a4">search</a>'   =&gt; $res,
00338                      'showSRes' =&gt; <span class="keyword">true</span>,
00339                      '<span class="keywordtype">id</span>'       =&gt; $<span class="keywordtype">id</span>
00340                      );
00341 
00342     }
00343 
<a name="l00353"></a><a class="code" href="classuiBrowser.html#a15">00353</a>     function <a class="code" href="classuiBrowser.html#a15">getFile</a>($<span class="keywordtype">id</span>)
00354     {
00355         $r = $this-&gt;gb-&gt;access($<span class="keywordtype">id</span>, $this-&gt;sessid);
00356         <span class="keywordflow">if</span>(PEAR::isError($r)) $_SESSION['<a class="code" href="classuiBrowser.html#a1">alertMsg</a>'] = $r-&gt;getMessage();
00357         <span class="keywordflow">else</span> print_r($r);
00358     }
00359 
<a name="l00368"></a><a class="code" href="classuiBrowser.html#a16">00368</a>     function <a class="code" href="classuiBrowser.html#a16">getMdata</a>($<span class="keywordtype">id</span>)
00369     {
00370         <span class="keywordflow">return</span>($this-&gt;gb-&gt;getMdata($<span class="keywordtype">id</span>, $this-&gt;sessid));
00371     }
00372 
<a name="l00380"></a><a class="code" href="classuiBrowser.html#a17">00380</a>     function <a class="code" href="classuiBrowser.html#a17">getInfo</a>($<span class="keywordtype">id</span>)
00381     {
00382         $ia = $this-&gt;gb-&gt;analyzeFile($<span class="keywordtype">id</span>, $this-&gt;sessid);
00383 
00384         <span class="keywordflow">return</span> <span class="stringliteral">"fileformat: {$ia['fileformat']}&lt;br&gt;</span>
00385 <span class="stringliteral">                channels: {$ia['audio']['channels']}&lt;br&gt;</span>
00386 <span class="stringliteral">                sample_rate: {$ia['audio']['sample_rate']}&lt;br&gt;</span>
00387 <span class="stringliteral">                bits_per_sample: {$ia['audio']['bits_per_sample']}&lt;br&gt;</span>
00388 <span class="stringliteral">                channelmode: {$ia['audio']['channelmode']}&lt;br&gt;</span>
00389 <span class="stringliteral">                title: {$ia['id3v1']['title']}&lt;br&gt;</span>
00390 <span class="stringliteral">                artist: {$ia['id3v1']['artist']}&lt;br&gt;</span>
00391 <span class="stringliteral">                comment: {$ia['id3v1']['comment']}"</span>;
00392     }
00393 
<a name="l00402"></a><a class="code" href="classuiBrowser.html#a18">00402</a>     function <a class="code" href="classuiBrowser.html#a18">getMetadataForm</a>($<span class="keywordtype">id</span>, &amp;$mask)
00403     {
00404         $form = <span class="keyword">new</span> HTML_QuickForm('<a class="code" href="ui__browser_8php.html#a12">editMetaData</a>', UI_STANDARD_FORM_METHOD, <a class="code" href="conf_8php.html#a1">UI_HANDLER</a>);
00405         $form-&gt;setConstants(array('act'=&gt;'<a class="code" href="ui__browser_8php.html#a12">editMetaData</a>',
00406                                   '<span class="keywordtype">id</span>'=&gt;$<span class="keywordtype">id</span>));
00407         $form-&gt;addElement('hidden', 'act');
00408         $form-&gt;addElement('hidden', '<span class="keywordtype">id</span>');
00409 
00410         $this-&gt;<a class="code" href="classuiBase.html#a1">_parseArr2Form</a>($form, $mask);
00411 
00412         <span class="keywordflow">return</span> $form-&gt;toHTML();
00413     }
00414 
00415 
<a name="l00416"></a><a class="code" href="classuiBrowser.html#a19">00416</a>     function <a class="code" href="classuiBrowser.html#a19">systemPrefs</a>(&amp;$mask)
00417     {
00418         $form = <span class="keyword">new</span> HTML_QuickForm('<a class="code" href="classuiBrowser.html#a19">systemPrefs</a>', UI_STANDARD_FORM_METHOD, <a class="code" href="conf_8php.html#a1">UI_HANDLER</a>);
00419         $form-&gt;setConstants(array('act'=&gt;'<a class="code" href="classuiBrowser.html#a19">systemPrefs</a>'));
00420         $form-&gt;addElement('hidden', 'act');
00421 
00422         $this-&gt;<a class="code" href="classuiBase.html#a1">_parseArr2Form</a>($form, $mask);
00423 
00424 <span class="preprocessor">        ## using Static Smarty Renderer</span>
00425 <span class="preprocessor"></span>        $renderer =&amp; <span class="keyword">new</span> HTML_QuickForm_Renderer_Array(<span class="keyword">true</span>, <span class="keyword">true</span>);
00426         $form-&gt;accept($renderer);
00427 
00428         <span class="keywordflow">return</span> $renderer-&gt;toArray();
00429     }
00430 }
00431 ?&gt;
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jan 12 16:22:49 2005 for LiveSupport&nbsp;-&nbsp;htmlUI&nbsp;module by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
